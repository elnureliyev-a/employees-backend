"use strict";var dt=Object.create;var z=Object.defineProperty;var ct=Object.getOwnPropertyDescriptor;var lt=Object.getOwnPropertyNames;var ut=Object.getPrototypeOf,ht=Object.prototype.hasOwnProperty;var ft=(r,e)=>{for(var t in e)z(r,t,{get:e[t],enumerable:!0})},Te=(r,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of lt(e))!ht.call(r,s)&&s!==t&&z(r,s,{get:()=>e[s],enumerable:!(o=ct(e,s))||o.enumerable});return r};var w=(r,e,t)=>(t=r!=null?dt(ut(r)):{},Te(e||!r||!r.__esModule?z(t,"default",{value:r,enumerable:!0}):t,r)),pt=r=>Te(z({},"__esModule",{value:!0}),r);var os={};ft(os,{LLDBDapExtension:()=>fe,activate:()=>rs});module.exports=pt(os);var E=w(require("vscode"));var q=w(require("path")),Fe=w(require("util")),v=w(require("vscode")),Ie=w(require("child_process")),J=w(require("node:fs/promises"));var Y=w(require("vscode")),M=class{constructor(e){this.settingId=e;this.label="Open Settings"}async action(){await Y.commands.executeCommand("workbench.action.openSettings",this.settingId??"@ext:llvm-vs-code-extensions.lldb-dap ")}},D=class{constructor(){this.label="Configure"}async action(){return null}};async function ke(r,e={},...t){let o=await Y.window.showErrorMessage(r,e,...t.map(s=>typeof s=="string"?s:s.label));for(let s of t)if(typeof s=="string"){if(o===s)return s}else if(o===s.label)return await s.action()}var _=class extends Error{constructor(e,...t){super(e),this.buttons=t}async showNotification(e={}){let t=this.buttons;return e.showConfigureButton!==!0&&(t=t.filter(o=>!(o instanceof D))),ke(this.message,e,...t)}};var Re=w(require("path")),R=w(require("vscode"));function gt(r){let e=r.getFullYear().toString().padStart(4,"0"),t=(r.getMonth()+1).toString().padStart(2,"0"),o=r.getDate().toString().padStart(2,"0"),s=r.getHours().toString().padStart(2,"0"),i=r.getMinutes().toString().padStart(2,"0"),a=r.getSeconds().toString().padStart(2,"0");return`${e}${t}${o}T${s}${i}${a}`}var K=class{constructor(e,t){this.context=e;this.logger=t;this.logFolder="";this.updateLogFolder(),e.subscriptions.push(R.workspace.onDidChangeConfiguration(o=>{o.affectsConfiguration("lldb-dap.logFolder")&&this.updateLogFolder()}))}get(e){let t=this.logFolder||this.context.logUri.fsPath;switch(e){case 0:return Re.join(t,`lldb-dap-${gt(new Date)}-${R.env.sessionId.split("-")[0]}.log`)}}updateLogFolder(){let t=R.workspace.getConfiguration("lldb-dap").get("logFolder")||this.context.logUri.fsPath;R.workspace.fs.createDirectory(R.Uri.file(t)).then(void 0,o=>{this.logger.error(`Failed to create log folder ${t}: ${o}`),t=this.context.logUri.fsPath}).then(()=>{this.logFolder=t,this.logger.info(`Persisting lldb-dap logs to ${t}`)})}};var F=w(require("os")),N=w(require("path"));function pe(r){if(F.platform()=="win32")return r;if(!r)return"";if(!r.startsWith("~"))return r;if(r.length==1)return F.homedir();if(r.charAt(1)==N.sep)return N.join(F.homedir(),r.substring(1));let t=r.indexOf(N.sep),o=t==-1?r.length:t,s=r.substring(1,o);try{if(s==F.userInfo().username)return N.join(F.homedir(),r.substring(o))}catch{return r}return r}var mt=Fe.promisify(Ie.execFile);async function G(r){try{await J.access(r,J.constants.X_OK)}catch{return!1}return!0}async function bt(r){if(process.platform==="darwin")try{let{stdout:e,stderr:t}=await mt("/usr/bin/xcrun",["-find",r]);if(e)return e.toString().trimEnd()}catch{}}async function wt(r){let e=process.platform==="win32"?process.env.Path:process.env.PATH;if(!e)return;let t=e.split(q.delimiter);for(let o of t){let s=q.join(o,r);if(await G(s))return s}}async function vt(){let r=process.platform==="win32"?"lldb-dap.exe":"lldb-dap",e=await bt(r);if(e)return e;let t=await wt(r);if(t)return t}function yt(r){return!(typeof r=="object"&&Object.values(r).findIndex(e=>typeof e!="string")!==-1||Array.isArray(r)&&r.findIndex(e=>typeof e!="string"||!/^\w+(=.*)?$/.test(e))!==-1)}async function _t(r,e){let t=e.debugAdapterExecutable;if(typeof t=="string"&&t.length!==0){if(t=pe(t),!await G(t))throw new _(`Debug adapter path "${t}" is not a valid file. The path comes from your launch configuration.`,new D);return t}let o=v.workspace.getConfiguration("lldb-dap",r),s=pe(o.get("executable-path")??"");if(s&&s.length!==0){if(!await G(s))throw new _(`Debug adapter path "${s}" is not a valid file. The path comes from your settings.`,new M("lldb-dap.executable-path"));return s}let i=await vt();if(i){if(!await G(i))throw new _(`Found a potential debug adapter on your system at "${s}", but it is not a valid file.`,new M("lldb-dap.executable-path"));return i}throw new _("Unable to find the path to the LLDB debug adapter executable.",new M("lldb-dap.executable-path"))}async function Pt(r,e){let t=e.debugAdapterArgs;if(t){if(!Array.isArray(t)||t.findIndex(o=>typeof o!="string")!==-1)throw new _("The debugAdapterArgs property must be an array of string values. Please update your launch configuration",new D);return t}return v.workspace.getConfiguration("lldb-dap",r).get("arguments",[])}async function Et(r,e){let t=e.debugAdapterEnv;if(t){if(yt(t)===!1)throw new _("The debugAdapterEnv property must be a dictionary of string keys and values OR an array of string values. Please update your launch configuration",new D);if(Array.isArray(t)){let s={};for(let i of t){let a=i.search("=");a>=0?s[i.substr(0,a)]=i.substr(a+1):s[i]=""}return s}else return t}return(v.workspace.workspaceFile?v.workspace.getConfiguration("lldb-dap"):v.workspace.getConfiguration("lldb-dap",r)).get("environment")||{}}async function ge(r,e,t,o){let i=(v.workspace.workspaceFile?v.workspace.getConfiguration("lldb-dap"):v.workspace.getConfiguration("lldb-dap",t)).get("log-path"),a={};i?a.LLDBDAP_LOG=i:v.workspace.getConfiguration("lldb-dap").get("captureSessionLogs",!1)&&(a.LLDBDAP_LOG=e.get(0));let n=await Et(t,o),d=await _t(t,o),l={env:{...n,...a},cwd:o.cwd??t?.uri.fsPath},c=await Pt(t,o);return r.info(`lldb-dap path: ${d}`),r.info(`lldb-dap args: ${c}`),r.info(`cwd: ${l.cwd}`),r.info(`env: ${JSON.stringify(l.env)}`),new v.DebugAdapterExecutable(d,c,l)}var V=class{constructor(e,t){this.logger=e;this.logFilePath=t;v.commands.registerCommand("lldb-dap.createDebugAdapterDescriptor",(o,s)=>this.createDebugAdapterDescriptor(o,s))}async createDebugAdapterDescriptor(e,t){if(this.logger.info(`Creating debug adapter for session "${e.name}"`),this.logger.info(`Session "${e.name}" debug configuration:
`+JSON.stringify(e.configuration,void 0,2)),t){let o=new Error("Setting the debug adapter executable in the package.json is not supported.");throw this.logger.error(o),o}return e.configuration.debugAdapterPort?(this.logger.info(`Spawning debug adapter server on port ${e.configuration.debugAdapterPort}`),new v.DebugAdapterServer(e.configuration.debugAdapterPort,e.configuration.debugAdapterHostname)):ge(this.logger,this.logFilePath,e.workspaceFolder,e.configuration)}};var O=class{constructor(){this._disposables=[]}dispose(){for(let e of this._disposables)e.dispose();this._disposables=[]}pushSubscription(...e){this._disposables.push(...e)}};var j=w(require("vscode")),X=class{async handleUri(e){try{let t=new URLSearchParams(e.query);if(e.path=="/start"){let o={type:"lldb-dap",request:"launch",name:""},s=t.get("config");s!==null&&Object.assign(o,JSON.parse(s));let i=["name","request","program","cwd","debuggerRoot"],a=["pid"],n=["args","initCommands","preRunCommands","stopCommands","exitCommands","terminateCommands","launchCommands","attachCommands"];for(let u of i){let p=t.get(u);p&&(o[u]=p)}for(let u of a){let p=t.get(u);p&&(o[u]=Number(p))}for(let u of n){let p=t.getAll(u);p&&(o[u]=p)}let d=new Set(["config"].concat(i).concat(a).concat(n)),l=new Set(t.keys()),c=new Set;for(let u of l.keys())d.has(u)||c.add(u);if(c.size>0)throw new Error(`Unsupported URL parameters: ${Array.from(c.keys()).join(", ")}`);let h=o.request=="launch"?"URL-based Launch":"URL-based Attach";if(o.name=o.name||o.program||h,o.type!="lldb-dap")throw new Error(`Unsupported debugger type: ${o.type}`);await j.debug.startDebugging(void 0,o)}else throw new Error(`Unsupported Uri path: ${e.path}`)}catch(t){t instanceof Error?await j.window.showErrorMessage(`Failed to handle lldb-dap URI request: ${t.message}`):await j.window.showErrorMessage(`Failed to handle lldb-dap URI request: ${JSON.stringify(t)}`)}}};var W=w(require("vscode")),Le=w(require("child_process")),Me=w(require("util"));var Dt=Me.promisify(Le.execFile);async function St(r){let{stdout:e}=await Dt(r,["--help"]);return/--connection/.test(e)}var xt={commandEscapePrefix:{type:"string",default:"`"},customFrameFormat:{type:"string",default:""},customThreadFormat:{type:"string",default:""},detachOnError:{type:"boolean",default:!1},disableASLR:{type:"boolean",default:!0},disableSTDIO:{type:"boolean",default:!1},displayExtendedBacktrace:{type:"boolean",default:!1},enableAutoVariableSummaries:{type:"boolean",default:!1},enableSyntheticChildDebugging:{type:"boolean",default:!1},timeout:{type:"number",default:30},platformName:{type:"string",default:""},targetTriple:{type:"string",default:""},initCommands:{type:"stringArray",default:[]},preRunCommands:{type:"stringArray",default:[]},postRunCommands:{type:"stringArray",default:[]},stopCommands:{type:"stringArray",default:[]},exitCommands:{type:"stringArray",default:[]},terminateCommands:{type:"stringArray",default:[]}};var Q=class{constructor(e,t,o){this.server=e;this.logger=t;this.logFilePath=o;W.commands.registerCommand("lldb-dap.resolveDebugConfiguration",(s,i,a)=>this.resolveDebugConfiguration(s,i,a)),W.commands.registerCommand("lldb-dap.resolveDebugConfigurationWithSubstitutedVariables",(s,i,a)=>this.resolveDebugConfigurationWithSubstitutedVariables(s,i,a))}async resolveDebugConfiguration(e,t,o){this.logger.info(`Resolving debug configuration for "${t.name}"`),this.logger.debug(`Initial debug configuration:
`+JSON.stringify(t,void 0,2));let s=W.workspace.getConfiguration("lldb-dap");for(let[i,a]of Object.entries(xt)){if(Reflect.has(t,i))continue;let n=s.get(i);if(!(n===void 0||n===a.default)){switch(a.type){case"string":if(typeof n!="string")throw new Error(`Expected ${i} to be a string, got ${n}`);break;case"number":if(typeof n!="number")throw new Error(`Expected ${i} to be a number, got ${n}`);break;case"boolean":if(typeof n!="boolean")throw new Error(`Expected ${i} to be a boolean, got ${n}`);break;case"stringArray":if(typeof n!="object"&&Array.isArray(n))throw new Error(`Expected ${i} to be a array of strings, got ${n}`);if(n.length===0)continue;break}t[i]=n}}return t}async resolveDebugConfigurationWithSubstitutedVariables(e,t,o){try{if("debugAdapterHostname"in t&&!("debugAdapterPort"in t))throw new _("A debugAdapterPort must be provided when debugAdapterHostname is set. Please update your launch configuration.",new D);if("debugAdapterPort"in t){if("debugAdapterExecutable"in t||"debugAdapterArgs"in t)throw new _("The debugAdapterPort property is incompatible with debugAdapterExecutable and debugAdapterArgs. Please update your launch configuration.",new D)}else{let s=await ge(this.logger,this.logFilePath,e,t);if(!s)return;let i=W.workspace.getConfiguration("lldb-dap",e);if(i.get("serverMode",!1)&&await St(s.command)){let a=i.get("connectionTimeout",void 0),n=await this.server.start(s.command,s.args,s.options,a);if(!n)return;delete t.debugAdapterExecutable,delete t.debugAdapterArgs,t.debugAdapterHostname=n.host,t.debugAdapterPort=n.port}}return this.logger.info(`Resolved debug configuration:
`+JSON.stringify(t,void 0,2)),t}catch(s){if(this.logger.error(s),!(s instanceof _))throw s;return await s.showNotification({modal:!0,showConfigureButton:!0})}}};var Qe=require("fs"),ne=require("fs/promises"),Ze=require("events"),f=w(require("path"),1);var A=require("node:fs/promises"),Ue=require("node:stream"),T=require("node:path"),P={FILE_TYPE:"files",DIR_TYPE:"directories",FILE_DIR_TYPE:"files_directories",EVERYTHING_TYPE:"all"},me={root:".",fileFilter:r=>!0,directoryFilter:r=>!0,type:P.FILE_TYPE,lstat:!1,depth:2147483648,alwaysStat:!1,highWaterMark:4096};Object.freeze(me);var $e="READDIRP_RECURSIVE_ERROR",Ct=new Set(["ENOENT","EPERM","EACCES","ELOOP",$e]),Ne=[P.DIR_TYPE,P.EVERYTHING_TYPE,P.FILE_DIR_TYPE,P.FILE_TYPE],At=new Set([P.DIR_TYPE,P.EVERYTHING_TYPE,P.FILE_DIR_TYPE]),Tt=new Set([P.EVERYTHING_TYPE,P.FILE_DIR_TYPE,P.FILE_TYPE]),kt=r=>Ct.has(r.code),Rt=process.platform==="win32",Oe=r=>!0,We=r=>{if(r===void 0)return Oe;if(typeof r=="function")return r;if(typeof r=="string"){let e=r.trim();return t=>t.basename===e}if(Array.isArray(r)){let e=r.map(t=>t.trim());return t=>e.some(o=>t.basename===o)}return Oe},be=class extends Ue.Readable{constructor(e={}){super({objectMode:!0,autoDestroy:!0,highWaterMark:e.highWaterMark});let t={...me,...e},{root:o,type:s}=t;this._fileFilter=We(t.fileFilter),this._directoryFilter=We(t.directoryFilter);let i=t.lstat?A.lstat:A.stat;Rt?this._stat=a=>i(a,{bigint:!0}):this._stat=i,this._maxDepth=t.depth??me.depth,this._wantsDir=s?At.has(s):!1,this._wantsFile=s?Tt.has(s):!1,this._wantsEverything=s===P.EVERYTHING_TYPE,this._root=(0,T.resolve)(o),this._isDirent=!t.alwaysStat,this._statsProp=this._isDirent?"dirent":"stats",this._rdOptions={encoding:"utf8",withFileTypes:this._isDirent},this.parents=[this._exploreDir(o,1)],this.reading=!1,this.parent=void 0}async _read(e){if(!this.reading){this.reading=!0;try{for(;!this.destroyed&&e>0;){let t=this.parent,o=t&&t.files;if(o&&o.length>0){let{path:s,depth:i}=t,a=o.splice(0,e).map(d=>this._formatEntry(d,s)),n=await Promise.all(a);for(let d of n){if(!d)continue;if(this.destroyed)return;let l=await this._getEntryType(d);l==="directory"&&this._directoryFilter(d)?(i<=this._maxDepth&&this.parents.push(this._exploreDir(d.fullPath,i+1)),this._wantsDir&&(this.push(d),e--)):(l==="file"||this._includeAsFile(d))&&this._fileFilter(d)&&this._wantsFile&&(this.push(d),e--)}}else{let s=this.parents.pop();if(!s){this.push(null);break}if(this.parent=await s,this.destroyed)return}}}catch(t){this.destroy(t)}finally{this.reading=!1}}}async _exploreDir(e,t){let o;try{o=await(0,A.readdir)(e,this._rdOptions)}catch(s){this._onError(s)}return{files:o,depth:t,path:e}}async _formatEntry(e,t){let o,s=this._isDirent?e.name:e;try{let i=(0,T.resolve)((0,T.join)(t,s));o={path:(0,T.relative)(this._root,i),fullPath:i,basename:s},o[this._statsProp]=this._isDirent?e:await this._stat(i)}catch(i){this._onError(i);return}return o}_onError(e){kt(e)&&!this.destroyed?this.emit("warn",e):this.destroy(e)}async _getEntryType(e){if(!e&&this._statsProp in e)return"";let t=e[this._statsProp];if(t.isFile())return"file";if(t.isDirectory())return"directory";if(t&&t.isSymbolicLink()){let o=e.fullPath;try{let s=await(0,A.realpath)(o),i=await(0,A.lstat)(s);if(i.isFile())return"file";if(i.isDirectory()){let a=s.length;if(o.startsWith(s)&&o.substr(a,1)===T.sep){let n=new Error(`Circular symlink detected: "${o}" points to "${s}"`);return n.code=$e,this._onError(n)}return"directory"}}catch(s){return this._onError(s),""}}}_includeAsFile(e){let t=e&&e[this._statsProp];return t&&this._wantsEverything&&!t.isDirectory()}};function je(r,e={}){let t=e.entryType||e.type;if(t==="both"&&(t=P.FILE_DIR_TYPE),t&&(e.type=t),r){if(typeof r!="string")throw new TypeError("readdirp: root argument must be a string. Usage: readdirp(root, options)");if(t&&!Ne.includes(t))throw new Error(`readdirp: Invalid type passed. Use one of ${Ne.join(", ")}`)}else throw new Error("readdirp: root argument is required. Usage: readdirp(root, options)");return e.root=r,new be(e)}var L=require("fs"),x=require("fs/promises"),m=w(require("path"),1),Be=require("os"),Ft="data",ye="end",ze="close",re=()=>{};var oe=process.platform,_e=oe==="win32",It=oe==="darwin",Lt=oe==="linux",Mt=oe==="freebsd",Ye=(0,Be.type)()==="OS400",b={ALL:"all",READY:"ready",ADD:"add",CHANGE:"change",ADD_DIR:"addDir",UNLINK:"unlink",UNLINK_DIR:"unlinkDir",RAW:"raw",ERROR:"error"},S=b,Nt="watch",Ot={lstat:x.lstat,stat:x.stat},I="listeners",Z="errHandlers",U="rawEmitters",Wt=[I,Z,U],Ut=new Set(["3dm","3ds","3g2","3gp","7z","a","aac","adp","afdesign","afphoto","afpub","ai","aif","aiff","alz","ape","apk","appimage","ar","arj","asf","au","avi","bak","baml","bh","bin","bk","bmp","btif","bz2","bzip2","cab","caf","cgm","class","cmx","cpio","cr2","cur","dat","dcm","deb","dex","djvu","dll","dmg","dng","doc","docm","docx","dot","dotm","dra","DS_Store","dsk","dts","dtshd","dvb","dwg","dxf","ecelp4800","ecelp7470","ecelp9600","egg","eol","eot","epub","exe","f4v","fbs","fh","fla","flac","flatpak","fli","flv","fpx","fst","fvt","g3","gh","gif","graffle","gz","gzip","h261","h263","h264","icns","ico","ief","img","ipa","iso","jar","jpeg","jpg","jpgv","jpm","jxr","key","ktx","lha","lib","lvp","lz","lzh","lzma","lzo","m3u","m4a","m4v","mar","mdi","mht","mid","midi","mj2","mka","mkv","mmr","mng","mobi","mov","movie","mp3","mp4","mp4a","mpeg","mpg","mpga","mxu","nef","npx","numbers","nupkg","o","odp","ods","odt","oga","ogg","ogv","otf","ott","pages","pbm","pcx","pdb","pdf","pea","pgm","pic","png","pnm","pot","potm","potx","ppa","ppam","ppm","pps","ppsm","ppsx","ppt","pptm","pptx","psd","pya","pyc","pyo","pyv","qt","rar","ras","raw","resources","rgb","rip","rlc","rmf","rmvb","rpm","rtf","rz","s3m","s7z","scpt","sgi","shar","snap","sil","sketch","slk","smv","snk","so","stl","suo","sub","swf","tar","tbz","tbz2","tga","tgz","thmx","tif","tiff","tlz","ttc","ttf","txz","udf","uvh","uvi","uvm","uvp","uvs","uvu","viv","vob","war","wav","wax","wbmp","wdp","weba","webm","webp","whl","wim","wm","wma","wmv","wmx","woff","woff2","wrm","wvx","xbm","xif","xla","xlam","xls","xlsb","xlsm","xlsx","xlt","xltm","xltx","xm","xmind","xpi","xpm","xwd","xz","z","zip","zipx"]),$t=r=>Ut.has(m.extname(r).slice(1).toLowerCase()),ve=(r,e)=>{r instanceof Set?r.forEach(e):e(r)},H=(r,e,t)=>{let o=r[e];o instanceof Set||(r[e]=o=new Set([o])),o.add(t)},jt=r=>e=>{let t=r[e];t instanceof Set?t.clear():delete r[e]},B=(r,e,t)=>{let o=r[e];o instanceof Set?o.delete(t):o===t&&delete r[e]},Ke=r=>r instanceof Set?r.size===0:!r,ee=new Map;function He(r,e,t,o,s){let i=(a,n)=>{t(r),s(a,n,{watchedPath:r}),n&&r!==n&&te(m.resolve(r,n),I,m.join(r,n))};try{return(0,L.watch)(r,{persistent:e.persistent},i)}catch(a){o(a);return}}var te=(r,e,t,o,s)=>{let i=ee.get(r);i&&ve(i[e],a=>{a(t,o,s)})},Ht=(r,e,t,o)=>{let{listener:s,errHandler:i,rawEmitter:a}=o,n=ee.get(e),d;if(!t.persistent)return d=He(r,t,s,i,a),d?d.close.bind(d):void 0;if(n)H(n,I,s),H(n,Z,i),H(n,U,a);else{if(d=He(r,t,te.bind(null,e,I),i,te.bind(null,e,U)),!d)return;d.on(S.ERROR,async l=>{let c=te.bind(null,e,Z);if(n&&(n.watcherUnusable=!0),_e&&l.code==="EPERM")try{await(await(0,x.open)(r,"r")).close(),c(l)}catch{}else c(l)}),n={listeners:s,errHandlers:i,rawEmitters:a,watcher:d},ee.set(e,n)}return()=>{B(n,I,s),B(n,Z,i),B(n,U,a),Ke(n.listeners)&&(n.watcher.close(),ee.delete(e),Wt.forEach(jt(n)),n.watcher=void 0,Object.freeze(n))}},we=new Map,Bt=(r,e,t,o)=>{let{listener:s,rawEmitter:i}=o,a=we.get(e),n=a&&a.options;return n&&(n.persistent<t.persistent||n.interval>t.interval)&&((0,L.unwatchFile)(e),a=void 0),a?(H(a,I,s),H(a,U,i)):(a={listeners:s,rawEmitters:i,options:t,watcher:(0,L.watchFile)(e,t,(d,l)=>{ve(a.rawEmitters,h=>{h(S.CHANGE,e,{curr:d,prev:l})});let c=d.mtimeMs;(d.size!==l.size||c>l.mtimeMs||c===0)&&ve(a.listeners,h=>h(r,d))})},we.set(e,a)),()=>{B(a,I,s),B(a,U,i),Ke(a.listeners)&&(we.delete(e),(0,L.unwatchFile)(e),a.options=a.watcher=void 0,Object.freeze(a))}},se=class{constructor(e){this.fsw=e,this._boundHandleError=t=>e._handleError(t)}_watchWithNodeFs(e,t){let o=this.fsw.options,s=m.dirname(e),i=m.basename(e);this.fsw._getWatchedDir(s).add(i);let n=m.resolve(e),d={persistent:o.persistent};t||(t=re);let l;if(o.usePolling){let c=o.interval!==o.binaryInterval;d.interval=c&&$t(i)?o.binaryInterval:o.interval,l=Bt(e,n,d,{listener:t,rawEmitter:this.fsw._emitRaw})}else l=Ht(e,n,d,{listener:t,errHandler:this._boundHandleError,rawEmitter:this.fsw._emitRaw});return l}_handleFile(e,t,o){if(this.fsw.closed)return;let s=m.dirname(e),i=m.basename(e),a=this.fsw._getWatchedDir(s),n=t;if(a.has(i))return;let d=async(c,h)=>{if(this.fsw._throttle(Nt,e,5)){if(!h||h.mtimeMs===0)try{let u=await(0,x.stat)(e);if(this.fsw.closed)return;let p=u.atimeMs,y=u.mtimeMs;if((!p||p<=y||y!==n.mtimeMs)&&this.fsw._emit(S.CHANGE,e,u),(It||Lt||Mt)&&n.ino!==u.ino){this.fsw._closeFile(c),n=u;let $=this._watchWithNodeFs(e,d);$&&this.fsw._addPathCloser(c,$)}else n=u}catch{this.fsw._remove(s,i)}else if(a.has(i)){let u=h.atimeMs,p=h.mtimeMs;(!u||u<=p||p!==n.mtimeMs)&&this.fsw._emit(S.CHANGE,e,h),n=h}}},l=this._watchWithNodeFs(e,d);if(!(o&&this.fsw.options.ignoreInitial)&&this.fsw._isntIgnored(e)){if(!this.fsw._throttle(S.ADD,e,0))return;this.fsw._emit(S.ADD,e,t)}return l}async _handleSymlink(e,t,o,s){if(this.fsw.closed)return;let i=e.fullPath,a=this.fsw._getWatchedDir(t);if(!this.fsw.options.followSymlinks){this.fsw._incrReadyCount();let n;try{n=await(0,x.realpath)(o)}catch{return this.fsw._emitReady(),!0}return this.fsw.closed?void 0:(a.has(s)?this.fsw._symlinkPaths.get(i)!==n&&(this.fsw._symlinkPaths.set(i,n),this.fsw._emit(S.CHANGE,o,e.stats)):(a.add(s),this.fsw._symlinkPaths.set(i,n),this.fsw._emit(S.ADD,o,e.stats)),this.fsw._emitReady(),!0)}if(this.fsw._symlinkPaths.has(i))return!0;this.fsw._symlinkPaths.set(i,!0)}_handleRead(e,t,o,s,i,a,n){if(e=m.join(e,""),n=this.fsw._throttle("readdir",e,1e3),!n)return;let d=this.fsw._getWatchedDir(o.path),l=new Set,c=this.fsw._readdirp(e,{fileFilter:h=>o.filterPath(h),directoryFilter:h=>o.filterDir(h)});if(c)return c.on(Ft,async h=>{if(this.fsw.closed){c=void 0;return}let u=h.path,p=m.join(e,u);if(l.add(u),!(h.stats.isSymbolicLink()&&await this._handleSymlink(h,e,p,u))){if(this.fsw.closed){c=void 0;return}(u===s||!s&&!d.has(u))&&(this.fsw._incrReadyCount(),p=m.join(i,m.relative(i,p)),this._addToNodeFs(p,t,o,a+1))}}).on(S.ERROR,this._boundHandleError),new Promise((h,u)=>{if(!c)return u();c.once(ye,()=>{if(this.fsw.closed){c=void 0;return}let p=n?n.clear():!1;h(void 0),d.getChildren().filter(y=>y!==e&&!l.has(y)).forEach(y=>{this.fsw._remove(e,y)}),c=void 0,p&&this._handleRead(e,!1,o,s,i,a,n)})})}async _handleDir(e,t,o,s,i,a,n){let d=this.fsw._getWatchedDir(m.dirname(e)),l=d.has(m.basename(e));!(o&&this.fsw.options.ignoreInitial)&&!i&&!l&&this.fsw._emit(S.ADD_DIR,e,t),d.add(m.basename(e)),this.fsw._getWatchedDir(e);let c,h,u=this.fsw.options.depth;if((u==null||s<=u)&&!this.fsw._symlinkPaths.has(n)){if(!i&&(await this._handleRead(e,o,a,i,e,s,c),this.fsw.closed))return;h=this._watchWithNodeFs(e,(p,y)=>{y&&y.mtimeMs===0||this._handleRead(p,!1,a,i,e,s,c)})}return h}async _addToNodeFs(e,t,o,s,i){let a=this.fsw._emitReady;if(this.fsw._isIgnored(e)||this.fsw.closed)return a(),!1;let n=this.fsw._getWatchHelpers(e);o&&(n.filterPath=d=>o.filterPath(d),n.filterDir=d=>o.filterDir(d));try{let d=await Ot[n.statMethod](n.watchPath);if(this.fsw.closed)return;if(this.fsw._isIgnored(n.watchPath,d))return a(),!1;let l=this.fsw.options.followSymlinks,c;if(d.isDirectory()){let h=m.resolve(e),u=l?await(0,x.realpath)(e):e;if(this.fsw.closed||(c=await this._handleDir(n.watchPath,d,t,s,i,n,u),this.fsw.closed))return;h!==u&&u!==void 0&&this.fsw._symlinkPaths.set(h,u)}else if(d.isSymbolicLink()){let h=l?await(0,x.realpath)(e):e;if(this.fsw.closed)return;let u=m.dirname(n.watchPath);if(this.fsw._getWatchedDir(u).add(n.watchPath),this.fsw._emit(S.ADD,n.watchPath,d),c=await this._handleDir(u,d,t,s,e,n,h),this.fsw.closed)return;h!==void 0&&this.fsw._symlinkPaths.set(m.resolve(e),h)}else c=this._handleFile(n.watchPath,d,t);return a(),c&&this.fsw._addPathCloser(e,c),!1}catch(d){if(this.fsw._handleError(d))return a(),e}}};var Pe="/",zt="//",et=".",Yt="..",Kt="string",Gt=/\\/g,Ge=/\/\//,Vt=/\..*\.(sw[px])$|~$|\.subl.*\.tmp/,qt=/^\.[/\\]/;function ie(r){return Array.isArray(r)?r:[r]}var Ee=r=>typeof r=="object"&&r!==null&&!(r instanceof RegExp);function Jt(r){return typeof r=="function"?r:typeof r=="string"?e=>r===e:r instanceof RegExp?e=>r.test(e):typeof r=="object"&&r!==null?e=>{if(r.path===e)return!0;if(r.recursive){let t=f.relative(r.path,e);return t?!t.startsWith("..")&&!f.isAbsolute(t):!1}return!1}:()=>!1}function Xt(r){if(typeof r!="string")throw new Error("string expected");r=f.normalize(r),r=r.replace(/\\/g,"/");let e=!1;r.startsWith("//")&&(e=!0);let t=/\/\//;for(;r.match(t);)r=r.replace(t,"/");return e&&(r="/"+r),r}function Ve(r,e,t){let o=Xt(e);for(let s=0;s<r.length;s++){let i=r[s];if(i(o,t))return!0}return!1}function Qt(r,e){if(r==null)throw new TypeError("anymatch: specify first argument");let o=ie(r).map(s=>Jt(s));return e==null?(s,i)=>Ve(o,s,i):Ve(o,e)}var qe=r=>{let e=ie(r).flat();if(!e.every(t=>typeof t===Kt))throw new TypeError(`Non-string provided as watch path: ${e}`);return e.map(tt)},Je=r=>{let e=r.replace(Gt,Pe),t=!1;for(e.startsWith(zt)&&(t=!0);e.match(Ge);)e=e.replace(Ge,Pe);return t&&(e=Pe+e),e},tt=r=>Je(f.normalize(Je(r))),Xe=(r="")=>e=>typeof e=="string"?tt(f.isAbsolute(e)?e:f.join(r,e)):e,Zt=(r,e)=>f.isAbsolute(r)?r:f.join(e,r),es=Object.freeze(new Set),De=class{constructor(e,t){this.path=e,this._removeWatcher=t,this.items=new Set}add(e){let{items:t}=this;t&&e!==et&&e!==Yt&&t.add(e)}async remove(e){let{items:t}=this;if(!t||(t.delete(e),t.size>0))return;let o=this.path;try{await(0,ne.readdir)(o)}catch{this._removeWatcher&&this._removeWatcher(f.dirname(o),f.basename(o))}}has(e){let{items:t}=this;if(t)return t.has(e)}getChildren(){let{items:e}=this;return e?[...e.values()]:[]}dispose(){this.items.clear(),this.path="",this._removeWatcher=re,this.items=es,Object.freeze(this)}},ts="stat",ss="lstat",Se=class{constructor(e,t,o){this.fsw=o;let s=e;this.path=e=e.replace(qt,""),this.watchPath=s,this.fullWatchPath=f.resolve(s),this.dirParts=[],this.dirParts.forEach(i=>{i.length>1&&i.pop()}),this.followSymlinks=t,this.statMethod=t?ts:ss}entryPath(e){return f.join(this.watchPath,f.relative(this.watchPath,e.fullPath))}filterPath(e){let{stats:t}=e;if(t&&t.isSymbolicLink())return this.filterDir(e);let o=this.entryPath(e);return this.fsw._isntIgnored(o,t)&&this.fsw._hasReadPermissions(t)}filterDir(e){return this.fsw._isntIgnored(this.entryPath(e),e.stats)}},xe=class extends Ze.EventEmitter{constructor(e={}){super(),this.closed=!1,this._closers=new Map,this._ignoredPaths=new Set,this._throttled=new Map,this._streams=new Set,this._symlinkPaths=new Map,this._watched=new Map,this._pendingWrites=new Map,this._pendingUnlinks=new Map,this._readyCount=0,this._readyEmitted=!1;let t=e.awaitWriteFinish,o={stabilityThreshold:2e3,pollInterval:100},s={persistent:!0,ignoreInitial:!1,ignorePermissionErrors:!1,interval:100,binaryInterval:300,followSymlinks:!0,usePolling:!1,atomic:!0,...e,ignored:e.ignored?ie(e.ignored):ie([]),awaitWriteFinish:t===!0?o:typeof t=="object"?{...o,...t}:!1};Ye&&(s.usePolling=!0),s.atomic===void 0&&(s.atomic=!s.usePolling);let i=process.env.CHOKIDAR_USEPOLLING;if(i!==void 0){let d=i.toLowerCase();d==="false"||d==="0"?s.usePolling=!1:d==="true"||d==="1"?s.usePolling=!0:s.usePolling=!!d}let a=process.env.CHOKIDAR_INTERVAL;a&&(s.interval=Number.parseInt(a,10));let n=0;this._emitReady=()=>{n++,n>=this._readyCount&&(this._emitReady=re,this._readyEmitted=!0,process.nextTick(()=>this.emit(b.READY)))},this._emitRaw=(...d)=>this.emit(b.RAW,...d),this._boundRemove=this._remove.bind(this),this.options=s,this._nodeFsHandler=new se(this),Object.freeze(s)}_addIgnoredPath(e){if(Ee(e)){for(let t of this._ignoredPaths)if(Ee(t)&&t.path===e.path&&t.recursive===e.recursive)return}this._ignoredPaths.add(e)}_removeIgnoredPath(e){if(this._ignoredPaths.delete(e),typeof e=="string")for(let t of this._ignoredPaths)Ee(t)&&t.path===e&&this._ignoredPaths.delete(t)}add(e,t,o){let{cwd:s}=this.options;this.closed=!1,this._closePromise=void 0;let i=qe(e);return s&&(i=i.map(a=>Zt(a,s))),i.forEach(a=>{this._removeIgnoredPath(a)}),this._userIgnored=void 0,this._readyCount||(this._readyCount=0),this._readyCount+=i.length,Promise.all(i.map(async a=>{let n=await this._nodeFsHandler._addToNodeFs(a,!o,void 0,0,t);return n&&this._emitReady(),n})).then(a=>{this.closed||a.forEach(n=>{n&&this.add(f.dirname(n),f.basename(t||n))})}),this}unwatch(e){if(this.closed)return this;let t=qe(e),{cwd:o}=this.options;return t.forEach(s=>{!f.isAbsolute(s)&&!this._closers.has(s)&&(o&&(s=f.join(o,s)),s=f.resolve(s)),this._closePath(s),this._addIgnoredPath(s),this._watched.has(s)&&this._addIgnoredPath({path:s,recursive:!0}),this._userIgnored=void 0}),this}close(){if(this._closePromise)return this._closePromise;this.closed=!0,this.removeAllListeners();let e=[];return this._closers.forEach(t=>t.forEach(o=>{let s=o();s instanceof Promise&&e.push(s)})),this._streams.forEach(t=>t.destroy()),this._userIgnored=void 0,this._readyCount=0,this._readyEmitted=!1,this._watched.forEach(t=>t.dispose()),this._closers.clear(),this._watched.clear(),this._streams.clear(),this._symlinkPaths.clear(),this._throttled.clear(),this._closePromise=e.length?Promise.all(e).then(()=>{}):Promise.resolve(),this._closePromise}getWatched(){let e={};return this._watched.forEach((t,o)=>{let i=(this.options.cwd?f.relative(this.options.cwd,o):o)||et;e[i]=t.getChildren().sort()}),e}emitWithAll(e,t){this.emit(e,...t),e!==b.ERROR&&this.emit(b.ALL,e,...t)}async _emit(e,t,o){if(this.closed)return;let s=this.options;_e&&(t=f.normalize(t)),s.cwd&&(t=f.relative(s.cwd,t));let i=[t];o!=null&&i.push(o);let a=s.awaitWriteFinish,n;if(a&&(n=this._pendingWrites.get(t)))return n.lastChange=new Date,this;if(s.atomic){if(e===b.UNLINK)return this._pendingUnlinks.set(t,[e,...i]),setTimeout(()=>{this._pendingUnlinks.forEach((d,l)=>{this.emit(...d),this.emit(b.ALL,...d),this._pendingUnlinks.delete(l)})},typeof s.atomic=="number"?s.atomic:100),this;e===b.ADD&&this._pendingUnlinks.has(t)&&(e=b.CHANGE,this._pendingUnlinks.delete(t))}if(a&&(e===b.ADD||e===b.CHANGE)&&this._readyEmitted){let d=(l,c)=>{l?(e=b.ERROR,i[0]=l,this.emitWithAll(e,i)):c&&(i.length>1?i[1]=c:i.push(c),this.emitWithAll(e,i))};return this._awaitWriteFinish(t,a.stabilityThreshold,e,d),this}if(e===b.CHANGE&&!this._throttle(b.CHANGE,t,50))return this;if(s.alwaysStat&&o===void 0&&(e===b.ADD||e===b.ADD_DIR||e===b.CHANGE)){let d=s.cwd?f.join(s.cwd,t):t,l;try{l=await(0,ne.stat)(d)}catch{}if(!l||this.closed)return;i.push(l)}return this.emitWithAll(e,i),this}_handleError(e){let t=e&&e.code;return e&&t!=="ENOENT"&&t!=="ENOTDIR"&&(!this.options.ignorePermissionErrors||t!=="EPERM"&&t!=="EACCES")&&this.emit(b.ERROR,e),e||this.closed}_throttle(e,t,o){this._throttled.has(e)||this._throttled.set(e,new Map);let s=this._throttled.get(e);if(!s)throw new Error("invalid throttle");let i=s.get(t);if(i)return i.count++,!1;let a,n=()=>{let l=s.get(t),c=l?l.count:0;return s.delete(t),clearTimeout(a),l&&clearTimeout(l.timeoutObject),c};a=setTimeout(n,o);let d={timeoutObject:a,clear:n,count:0};return s.set(t,d),d}_incrReadyCount(){return this._readyCount++}_awaitWriteFinish(e,t,o,s){let i=this.options.awaitWriteFinish;if(typeof i!="object")return;let a=i.pollInterval,n,d=e;this.options.cwd&&!f.isAbsolute(e)&&(d=f.join(this.options.cwd,e));let l=new Date,c=this._pendingWrites;function h(u){(0,Qe.stat)(d,(p,y)=>{if(p||!c.has(e)){p&&p.code!=="ENOENT"&&s(p);return}let $=Number(new Date);u&&y.size!==u.size&&(c.get(e).lastChange=$);let at=c.get(e);$-at.lastChange>=t?(c.delete(e),s(void 0,y)):n=setTimeout(h,a,y)})}c.has(e)||(c.set(e,{lastChange:l,cancelWait:()=>(c.delete(e),clearTimeout(n),o)}),n=setTimeout(h,a))}_isIgnored(e,t){if(this.options.atomic&&Vt.test(e))return!0;if(!this._userIgnored){let{cwd:o}=this.options,i=(this.options.ignored||[]).map(Xe(o)),n=[...[...this._ignoredPaths].map(Xe(o)),...i];this._userIgnored=Qt(n,void 0)}return this._userIgnored(e,t)}_isntIgnored(e,t){return!this._isIgnored(e,t)}_getWatchHelpers(e){return new Se(e,this.options.followSymlinks,this)}_getWatchedDir(e){let t=f.resolve(e);return this._watched.has(t)||this._watched.set(t,new De(t,this._boundRemove)),this._watched.get(t)}_hasReadPermissions(e){return this.options.ignorePermissionErrors?!0:!!(Number(e.mode)&256)}_remove(e,t,o){let s=f.join(e,t),i=f.resolve(s);if(o=o??(this._watched.has(s)||this._watched.has(i)),!this._throttle("remove",s,100))return;!o&&this._watched.size===1&&this.add(e,t,!0),this._getWatchedDir(s).getChildren().forEach(u=>this._remove(s,u));let d=this._getWatchedDir(e),l=d.has(t);d.remove(t),this._symlinkPaths.has(i)&&this._symlinkPaths.delete(i);let c=s;if(this.options.cwd&&(c=f.relative(this.options.cwd,s)),this.options.awaitWriteFinish&&this._pendingWrites.has(c)&&this._pendingWrites.get(c).cancelWait()===b.ADD)return;this._watched.delete(s),this._watched.delete(i);let h=o?b.UNLINK_DIR:b.UNLINK;l&&!this._isIgnored(s)&&this._emit(h,s),this._closePath(s)}_closePath(e){this._closeFile(e);let t=f.dirname(e);this._getWatchedDir(t).remove(f.basename(e))}_closeFile(e){let t=this._closers.get(e);t&&(t.forEach(o=>o()),this._closers.delete(e))}_addPathCloser(e,t){if(!t)return;let o=this._closers.get(e);o||(o=[],this._closers.set(e,o)),o.push(t)}_readdirp(e,t){if(this.closed)return;let o={type:b.ALL,alwaysStat:!0,lstat:!0,...t,depth:0},s=je(e,o);return this._streams.add(s),s.once(ze,()=>{s=void 0}),s.once(ye,()=>{s&&(this._streams.delete(s),s=void 0)}),s}};function st(r,e={}){let t=new xe(e);return t.add(r),t}var rt=w(require("node:child_process")),ot=require("util"),de=w(require("vscode")),ae=class{constructor(){de.commands.registerCommand("lldb-dap.getServerProcess",()=>this.serverProcess)}async start(e,t,o,s){let i=s&&s>0?["--connection-timeout",`${s}`]:[],a=[...t,"--connection","listen://localhost:0",...i];if(await this.shouldContinueStartup(e,a,o?.env))return this.serverInfo?this.serverInfo:(this.serverInfo=new Promise((n,d)=>{let l=rt.spawn(e,a,o);l.on("error",c=>{d(c),this.cleanUp(l)}),l.on("exit",(c,h)=>{let u="Server process exited early";c!==void 0?u+=` with code ${c}`:h!==void 0&&(u+=` due to signal ${h}`),d(new Error(u)),this.cleanUp(l)}),l.stdout.setEncoding("utf8").on("data",c=>{let h=/connection:\/\/\[([^\]]+)\]:(\d+)/.exec(c.toString());if(h){let u=h[1],p=Number(h[2]);n({host:u,port:p}),l.stdout.removeAllListeners()}}),this.serverProcess=l,this.serverSpawnInfo=this.getSpawnInfo(e,a,o?.env),this.serverFileChanged=!1,this.serverFileWatcher=st(e),this.serverFileWatcher.on("change",()=>this.serverFileChanged=!0).on("unlink",()=>this.serverFileChanged=!0)}),this.serverInfo)}async shouldContinueStartup(e,t,o){if(!this.serverProcess||!this.serverInfo||!this.serverSpawnInfo||!this.serverFileWatcher||this.serverFileChanged===void 0)return!0;let s=[],i=[];this.serverFileChanged&&s.push("an old binary");let a=this.getSpawnInfo(e,t,o);if((0,ot.isDeepStrictEqual)(this.serverSpawnInfo,a)||(s.push("different arguments"),i.push(`
The previous lldb-dap server was started with:

${this.serverSpawnInfo.join(" ")}

The new lldb-dap server will be started with:

${a.join(" ")}
`)),s.length===0)return!0;switch(await de.window.showInformationMessage("The lldb-dap server has changed. Would you like to restart the server?",{modal:!0,detail:`An existing lldb-dap server (${this.serverProcess.pid}) is running with ${s.map(d=>`*${d}*`).join(" and ")}.
${i.join(`
`)}
Restarting the server will interrupt any existing debug sessions and start a new server.`},"Restart","Use Existing")){case"Restart":return this.dispose(),!0;case"Use Existing":return!0;case void 0:return!1}}dispose(){this.serverProcess&&(this.serverProcess.kill(),this.cleanUp(this.serverProcess))}cleanUp(e){this.serverProcess===e&&(this.serverProcess=void 0,this.serverInfo=void 0,this.serverSpawnInfo=void 0,this.serverFileWatcher?.close(),this.serverFileWatcher=void 0,this.serverFileChanged=void 0)}getSpawnInfo(e,t,o){return[e,...t,...Object.entries(o??{}).filter(s=>String(s[0])!=="LLDBDAP_LOG").sort().map(s=>String(s[0])+"="+String(s[1]))]}};var k=w(require("vscode"));function Ce(r,e){return r.type==="event"&&(!e||r.event===e)}var ce=class{constructor(e){this.logger=e;this.modules=new Map;this.modulesChanged=new k.EventEmitter;this.sessionReceivedCapabilities=new k.EventEmitter;this.sessionExited=new k.EventEmitter;this.onDidChangeModules=this.modulesChanged.event;this.onDidReceiveSessionCapabilities=this.sessionReceivedCapabilities.event;this.onDidExitSession=this.sessionExited.event;this.onDidChangeModules(this.moduleChangedListener,this),k.debug.onDidChangeActiveDebugSession(t=>this.modulesChanged.fire(t))}dispose(){this.modules.clear(),this.modulesChanged.dispose()}createDebugAdapterTracker(e){this.logger.info(`Starting debug session "${e.name}"`);let t=!1;return{onError:o=>!t&&this.logger.error(o),onDidSendMessage:o=>this.onDidSendMessage(e,o),onWillStopSession:()=>t=!0,onExit:()=>this.onExit(e)}}debugSessionModules(e){return this.modules.get(e)??[]}onExit(e){this.modules.delete(e),this.modulesChanged.fire(void 0)}showModulesTreeView(e){k.commands.executeCommand("setContext","lldb-dap.showModules",e)}moduleChangedListener(e){if(!e){this.showModulesTreeView(!1);return}if(e==k.debug.activeDebugSession){let t=this.modules.get(e)!=null;this.showModulesTreeView(t)}}onDidSendMessage(e,t){if(Ce(t,"module")){let{module:o,reason:s}=t.body,i=this.modules.get(e)??[];switch(s){case"new":case"changed":{let a=i.findIndex(n=>n.id===o.id);a!==-1?i[a]=o:i.push(o);break}case"removed":{let a=i.findIndex(n=>n.id===o.id);a!==-1&&i.splice(a,1);break}default:console.error("unexpected module event reason");break}this.modules.set(e,i),this.modulesChanged.fire(e)}else if(Ce(t,"exited")){let{exitCode:o}=t.body;this.logger.info(`Session "${e.name}" exited with code ${o}`),this.sessionExited.fire(e)}else Ce(t,"capabilities")&&this.sessionReceivedCapabilities.fire([e,t.body.capabilities])}};var C=w(require("vscode"));function it(r){return r.id!==void 0}var le=class extends C.TreeItem{constructor(e){super(e.name,C.TreeItemCollapsibleState.Collapsed),this.description=e.symbolStatus,this.contextValue="module"}static getProperties(e){let t=[];return t.push({key:"id:",value:e.id.toString()}),e.addressRange&&t.push({key:"load address:",value:e.addressRange}),e.path&&t.push({key:"path:",value:e.path}),e.version&&t.push({key:"version:",value:e.version}),e.symbolFilePath&&t.push({key:"symbol filepath:",value:e.symbolFilePath}),t}},ue=class{constructor(e){this.tracker=e;this.changeTreeData=new C.EventEmitter;this.onDidChangeTreeData=this.changeTreeData.event;e.onDidChangeModules(()=>this.changeTreeData.fire())}getTreeItem(e){if(it(e))return new le(e);let t=new C.TreeItem(e.key);return t.description=e.value,t.tooltip=`${e.key} ${e.value}`,t.contextValue="property",t}getChildren(e){return C.debug.activeDebugSession?e?it(e)?le.getProperties(e):[]:this.tracker.debugSessionModules(C.debug.activeDebugSession):[]}};var g=w(require("vscode"));function nt(r,e,t){return`<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link href="${e}" rel="stylesheet">
    <style>
      .tabulator {
        background-color: var(--vscode-editor-background);
        color: var(--vscode-editor-foreground);
      }

      .tabulator .tabulator-header {
        background-color: var(--vscode-tree-tableOddRowsBackground);
        color: var(--vscode-editor-foreground);
      }

      .tabulator .tabulator-header .tabulator-col {
        background-color: var(--vscode-tree-tableOddRowsBackground);
        color: var(--vscode-editor-foreground);
      }

      .tabulator-row {
        background-color: var(--vscode-editor-background);
        color: var(--vscode-editor-foreground);
      }

      .tabulator-row.tabulator-row-even {
        background-color: var(--vscode-tree-tableOddRowsBackground);
      }

      @media (hover:hover) and (pointer:fine){
        .tabulator-row:hover {
          background-color: var(--vscode-list-hoverBackground);
          color: var(--vscode-list-hoverForeground);
        }
      }

      .tabulator-row.tabulator-selected {
        background-color: var(--vscode-editor-background);
        color: var(--vscode-editor-foreground);
      }

      .tabulator .tabulator-tableholder .tabulator-table {
        background-color: var(--vscode-editor-background);
        color: var(--vscode-editor-foreground);
      }

      .tabulator-cell {
        text-overflow: clip !important;
      }

      #symbols-table {
        width: 100%;
        height: 100vh;
      }
    </style>
</head>
<body>
    <div id="symbols-table"></div>
    <script src="${r}"></script>
    <script src="${t}"></script>
</body>
</html>`}var he=class extends O{constructor(t,o){super();this.tracker=t;this.extensionContext=o;this.pushSubscription(g.commands.registerCommand("lldb-dap.debug.showSymbols",()=>{let s=g.debug.activeDebugSession;s&&this.SelectModuleAndShowSymbols(s)})),this.pushSubscription(g.commands.registerCommand("lldb-dap.modules.showSymbols",s=>{let i=g.debug.activeDebugSession;i&&this.showSymbolsForModule(i,s)})),this.tracker.onDidReceiveSessionCapabilities(([s,i])=>{i.supportsModuleSymbolsRequest&&g.commands.executeCommand("setContext","lldb-dap.supportsModuleSymbolsRequest",!0)}),this.tracker.onDidExitSession(s=>{g.commands.executeCommand("setContext","lldb-dap.supportsModuleSymbolsRequest",!1)})}async SelectModuleAndShowSymbols(t){let o=this.tracker.debugSessionModules(t);if(!o||o.length===0)return;let s=await g.window.showQuickPick(o.map(i=>new Ae(i)),{placeHolder:"Select a module to show symbols for"});s&&await this.showSymbolsForModule(t,s.module)}async showSymbolsForModule(t,o){try{let s=await this.getSymbolsForModule(t,o.id.toString());await this.showSymbolsInNewTab(o.name.toString(),s)}catch(s){s instanceof Error?await g.window.showErrorMessage("Failed to retrieve symbols: "+s.message):await g.window.showErrorMessage("Failed to retrieve symbols due to an unknown error.");return}}async getSymbolsForModule(t,o){return(await t.customRequest("__lldb_moduleSymbols",{moduleId:o,moduleName:""}))?.symbols||[]}async showSymbolsInNewTab(t,o){let s=g.window.createWebviewPanel("lldb-dap.symbols",`Symbols for ${t}`,g.ViewColumn.Active,{enableScripts:!0,localResourceRoots:[this.getExtensionResourcePath()]}),i="tabulator_simple.min.css";(g.window.activeColorTheme.kind===g.ColorThemeKind.Dark||g.window.activeColorTheme.kind===g.ColorThemeKind.HighContrast)&&(i="tabulator_midnight.min.css");let a=s.webview.asWebviewUri(g.Uri.joinPath(this.getExtensionResourcePath(),i)),n=s.webview.asWebviewUri(g.Uri.joinPath(this.getExtensionResourcePath(),"tabulator.min.js")),d=s.webview.asWebviewUri(g.Uri.joinPath(this.getExtensionResourcePath(),"symbols-table-view.js"));s.webview.html=nt(n,a,d),await s.webview.postMessage({command:"updateSymbols",symbols:o})}getExtensionResourcePath(){return g.Uri.joinPath(this.extensionContext.extensionUri,"out","webview")}},Ae=class{constructor(e){this.module=e}get label(){return this.module.name}get description(){return this.module.id.toString()}};var fe=class extends O{constructor(e,t,o,s){super();let i=new ae,a=new ce(t);this.pushSubscription(t,s,i,a,E.debug.registerDebugConfigurationProvider("lldb-dap",new Q(i,t,o)),E.debug.registerDebugAdapterDescriptorFactory("lldb-dap",new V(t,o)),E.debug.registerDebugAdapterTrackerFactory("lldb-dap",a),E.window.registerTreeDataProvider("lldb-dap.modules",new ue(a)),E.window.registerUriHandler(new X)),this.pushSubscription(E.commands.registerCommand("lldb-dap.modules.copyProperty",n=>E.env.clipboard.writeText(n.value))),this.pushSubscription(new he(a,e))}};async function rs(r){let e=E.window.createOutputChannel("LLDB-DAP",{log:!0});e.info("LLDB-DAP extension activating...");let t=new K(r,e);r.subscriptions.push(new fe(r,e,t,e)),e.info("LLDB-DAP extension activated")}0&&(module.exports={LLDBDapExtension,activate});
/*! Bundled license information:

chokidar/esm/index.js:
  (*! chokidar - MIT License (c) 2012 Paul Miller (paulmillr.com) *)
*/
